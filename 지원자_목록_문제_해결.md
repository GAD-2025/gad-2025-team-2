# 고용주가 지원자를 볼 수 없는 문제 해결 가이드

## 🔍 문제 상황
구직자가 공고에 지원했는데, 고용주가 채용 페이지에서 지원자를 볼 수 없습니다.

## 📋 가능한 원인

### 1. 데이터베이스 연결 문제
- `applications` 테이블에 지원 내역이 저장되지 않음
- `jobs.employerId`가 NULL이거나 잘못된 값
- `employers` 테이블에 고용주 레코드가 없음
- `employer_profiles`와 `employers` 간의 연결이 끊어짐
- `jobseekers` 테이블에 구직자 정보가 없음

### 2. API 연결 문제
- `userId`로 `employerId`를 찾는 과정에서 실패
- `employerId`로 공고를 찾는 과정에서 실패
- 지원 내역을 조회하는 과정에서 실패

## 🔧 해결 방법

### 단계 1: 데이터베이스 진단

MySQL Workbench에서 `지원자_목록_문제_진단.sql` 파일을 실행하세요.

**확인 사항:**
1. **전체 지원 내역 확인**: `applications` 테이블에 데이터가 있는지
2. **지원-공고 연결**: `applications.jobId`가 `jobs.id`와 올바르게 연결되는지
3. **공고-고용주 연결**: `jobs.employerId`가 `employers.id`와 올바르게 연결되는지
4. **고용주 프로필-고용주 연결**: `employer_profiles.id`가 `employers.businessNo`와 일치하는지
5. **지원-구직자 연결**: `applications.seekerId`가 `jobseekers.id`와 일치하는지

### 단계 2: 문제별 해결 방법

#### 문제 A: `jobs.employerId`가 NULL이거나 잘못된 값

**확인:**
```sql
SELECT j.id, j.title, j.employerId, e.id as employer_exists
FROM jobs j
LEFT JOIN employers e ON j.employerId = e.id
WHERE j.employerId IS NULL OR e.id IS NULL;
```

**해결:**
- 공고를 다시 등록하면 `employerId`가 자동으로 설정됩니다
- 또는 수동으로 `employerId`를 업데이트:
```sql
UPDATE jobs j
INNER JOIN stores s ON j.store_id = s.id
INNER JOIN employers e ON e.businessNo = (
    SELECT ep.id FROM employer_profiles ep WHERE ep.user_id = s.user_id
)
SET j.employerId = e.id
WHERE j.employerId IS NULL OR j.employerId = '';
```

#### 문제 B: `employers` 테이블에 레코드가 없음

**확인:**
```sql
SELECT ep.id, ep.user_id, ep.company_name, e.id as employer_exists
FROM employer_profiles ep
LEFT JOIN employers e ON e.businessNo = ep.id
WHERE e.id IS NULL;
```

**해결:**
- 공고를 등록하면 `employers` 레코드가 자동으로 생성되어야 합니다
- 수동으로 생성하려면:
```sql
INSERT INTO employers (id, businessNo, shopName, industry, address, openHours, contact, media, minLanguageLevel, needVisa, baseWage, schedule)
SELECT 
    CONCAT('employer-', SUBSTRING(ep.id, 1, 12)) as id,
    ep.id as businessNo,
    COALESCE(ep.company_name, '회사명 없음') as shopName,
    '기타' as industry,
    COALESCE(ep.address, '') as address,
    '09:00-18:00' as openHours,
    COALESCE((SELECT email FROM signup_users WHERE id = ep.user_id), '') as contact,
    '[]' as media,
    'TOPIK 1급' as minLanguageLevel,
    '[]' as needVisa,
    10000 as baseWage,
    '09:00-18:00' as schedule
FROM employer_profiles ep
WHERE NOT EXISTS (
    SELECT 1 FROM employers e WHERE e.businessNo = ep.id
);
```

#### 문제 C: `jobseekers` 테이블에 구직자 정보가 없음

**확인:**
```sql
SELECT a.seekerId, js.id as jobseeker_exists, su.name
FROM applications a
LEFT JOIN jobseekers js ON js.id = a.seekerId
LEFT JOIN signup_users su ON su.id = a.seekerId
WHERE js.id IS NULL;
```

**해결:**
- 구직자가 지원하면 `ensure_jobseeker_exists` 함수가 자동으로 `jobseekers` 레코드를 생성합니다
- 수동으로 생성하려면 백엔드 API를 호출하거나, 지원을 다시 시도하세요

#### 문제 D: 지원 내역이 `applications` 테이블에 저장되지 않음

**확인:**
```sql
SELECT COUNT(*) as application_count FROM applications;
```

**해결:**
- 구직자가 다시 지원을 시도하세요
- 백엔드 로그에서 `create_application` 함수의 오류 메시지를 확인하세요

### 단계 3: 백엔드 로그 확인

백엔드 서버 PowerShell 창에서 다음 로그를 확인하세요:

**지원 내역 조회 시:**
```
[DEBUG] list_applications - 요청 파라미터:
  userId: employer-xxxxx
[DEBUG] list_applications - userId로 employerId 찾기 시작: ...
[DEBUG] list_applications - employer profile 조회 결과: ...
[DEBUG] list_applications - employer 조회 결과: ...
[DEBUG] list_applications - employerId 설정 완료: ...
[DEBUG] list_applications - employerId로 공고 필터링 시작: ...
[DEBUG] list_applications - 이 고용주의 공고 개수: ...
[DEBUG] list_applications - 최종 반환할 결과 개수: ...
```

**오류 메시지 확인:**
- `[ERROR] employer_profile을 찾을 수 없음` → `employer_profiles` 테이블 확인
- `[ERROR] employer를 찾을 수 없음` → `employers` 테이블 확인
- `[WARNING] 이 고용주에게 공고가 없음` → 공고 등록 필요
- `[WARNING] 반환할 결과가 없습니다` → 지원 내역이 없거나 연결 문제

### 단계 4: 프론트엔드 콘솔 확인

브라우저 개발자 도구(F12) → Console 탭에서:

```
[DEBUG] Applications response: ...
[DEBUG] Applications count: ...
[DEBUG] User ID used: ...
```

**확인 사항:**
- `Applications count`가 0인지
- `User ID used`가 올바른 고용주 user_id인지
- 오류 메시지가 있는지

## ✅ 체크리스트

- [ ] MySQL Workbench에서 `지원자_목록_문제_진단.sql` 실행
- [ ] `applications` 테이블에 지원 내역이 있는지 확인
- [ ] `jobs.employerId`가 올바르게 설정되어 있는지 확인
- [ ] `employers` 테이블에 고용주 레코드가 있는지 확인
- [ ] `employer_profiles`와 `employers` 간의 연결이 올바른지 확인
- [ ] 백엔드 로그에서 오류 메시지 확인
- [ ] 프론트엔드 콘솔에서 디버깅 정보 확인

## 🔧 빠른 해결 방법

만약 위의 진단이 복잡하다면, 다음을 시도하세요:

1. **고용주로 로그인**
2. **새 공고 등록** (이렇게 하면 `employers` 레코드가 자동 생성됨)
3. **구직자로 로그인하여 해당 공고에 지원**
4. **고용주로 다시 로그인하여 채용 페이지 확인**

## 📝 추가 정보

문제가 계속되면 다음 정보를 제공해주세요:
1. MySQL Workbench에서 실행한 진단 SQL 결과
2. 백엔드 서버 로그의 오류 메시지
3. 브라우저 콘솔의 디버깅 정보
4. 고용주 user_id와 구직자 user_id

