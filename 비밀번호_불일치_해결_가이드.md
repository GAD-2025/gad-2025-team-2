# 비밀번호 불일치 문제 해결 가이드

## 문제 상황
SQL에서 회원가입한 정보가 보이고 비밀번호가 있는데도 로그인 시 "비밀번호가 일치하지 않습니다" 오류가 발생합니다.

## 가능한 원인

### 1. 비밀번호 해시 형식 문제
- 데이터베이스에 저장된 비밀번호 해시가 올바르지 않을 수 있습니다
- SHA256 해시는 항상 **64자리**여야 합니다
- 해시에 공백이나 특수 문자가 포함되어 있을 수 있습니다

### 2. 비밀번호 공백 문제
- 회원가입 시 비밀번호 앞뒤에 공백이 포함되었을 수 있습니다
- 로그인 시 입력한 비밀번호와 저장된 해시가 다를 수 있습니다

### 3. 인코딩 문제
- 비밀번호가 다른 인코딩으로 저장되었을 수 있습니다

## 해결 방법

### 단계 1: 백엔드 서버 재시작
백엔드 코드를 수정했으므로 **반드시 백엔드 서버를 재시작**해야 합니다.

1. 현재 실행 중인 백엔드 서버를 중지 (Ctrl+C)
2. 백엔드 서버를 다시 시작:
   ```powershell
   cd gad-2025-team-2\backend
   .\venv\Scripts\python.exe -m uvicorn app.main:app --reload
   ```

### 단계 2: MySQL Workbench에서 비밀번호 상태 확인

`비밀번호_불일치_진단_및_수정.sql` 파일을 MySQL Workbench에서 실행하세요.

**1번 쿼리**를 실행하여 최근 가입한 계정의 비밀번호 상태를 확인:
- `password_length`가 **64**인지 확인
- `password_status`가 **"정상 (64자리)"**인지 확인

### 단계 3: 로그인 시도 및 백엔드 로그 확인

1. 브라우저에서 로그인을 시도하세요
2. 백엔드 서버 PowerShell 창에서 다음 로그를 확인하세요:

```
[DEBUG] 입력 비밀번호 원문 길이: XX
[DEBUG] 입력 비밀번호 해시: xxxxxx...
[DEBUG] 입력 비밀번호 해시 길이: 64
[DEBUG] 저장된 비밀번호 해시: xxxxxx...
[DEBUG] 저장된 비밀번호 해시 길이: XX
[DEBUG] 해시 일치 여부: True/False
```

**중요 확인 사항:**
- 입력 비밀번호 해시 길이가 **64**인지
- 저장된 비밀번호 해시 길이가 **64**인지
- 해시 일치 여부가 **False**인 경우, 두 해시 값을 비교

### 단계 4: 비밀번호 재설정 (필요한 경우)

만약 저장된 비밀번호 해시가 64자리가 아니거나, 해시가 일치하지 않는 경우:

#### 방법 A: Python 스크립트 사용 (권장)

1. `비밀번호_해시_생성기.py` 실행:
   ```powershell
   cd gad-2025-team-2
   python 비밀번호_해시_생성기.py
   ```

2. 본인이 사용할 비밀번호를 입력하세요 (예: `mypassword123`)

3. 생성된 해시를 복사하세요

4. MySQL Workbench에서 다음 쿼리 실행:
   ```sql
   USE team2_db;
   
   -- 아래 값을 수정하세요
   SET @reset_phone = '01012345678';  -- 본인의 전화번호
   SET @new_password_hash = '생성된_해시_값';  -- Python에서 생성한 해시
   
   UPDATE signup_users
   SET password = @new_password_hash
   WHERE role = 'job_seeker'
     AND phone = @reset_phone;
   ```

#### 방법 B: SQL에서 직접 수정

`비밀번호_불일치_진단_및_수정.sql` 파일의 **3번 쿼리**를 사용:

1. `@reset_phone`을 본인의 전화번호로 변경
2. `@new_password_hash`를 원하는 비밀번호의 해시로 변경
   - 기본 비밀번호 `password123`의 해시: `ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f`
3. 주석(`--`)을 제거하여 UPDATE 쿼리 실행

### 단계 5: 새 계정으로 테스트

비밀번호를 재설정한 후:

1. 백엔드 서버가 실행 중인지 확인
2. 브라우저에서 로그인 시도
3. 백엔드 로그에서 `[DEBUG] 해시 일치 여부: True` 확인

## 체크리스트

- [ ] 백엔드 서버를 재시작했는가?
- [ ] MySQL Workbench에서 비밀번호 해시 길이가 64자인가?
- [ ] 백엔드 로그에서 입력 해시와 저장 해시를 비교했는가?
- [ ] 비밀번호를 재설정한 경우, 새 해시로 업데이트했는가?
- [ ] 로그인 시도 후 백엔드 로그에서 `해시 일치 여부: True`가 나오는가?

## 추가 디버깅 정보

백엔드 로그에서 다음 정보를 확인하세요:

1. **로그인 시도 시:**
   ```
   [LOGIN] 로그인 시도: role=job_seeker, identifier=01012345678
   [SUCCESS] 사용자 발견: id=..., name=..., role=job_seeker
   [DEBUG] 입력 비밀번호 원문 길이: XX
   [DEBUG] 입력 비밀번호 해시: ...
   [DEBUG] 저장된 비밀번호 해시: ...
   [DEBUG] 해시 일치 여부: True/False
   ```

2. **회원가입 시 (새 계정 생성 시):**
   ```
   [SIGNUP] 비밀번호 해시 생성: 원문 길이=XX, 해시=...
   ```

## 문제가 계속되면

1. 백엔드 로그의 전체 오류 메시지를 확인하세요
2. MySQL Workbench에서 `비밀번호_불일치_진단_및_수정.sql`의 **5번 쿼리**를 실행하여 비밀번호 길이 통계를 확인하세요
3. 새 계정을 다시 생성해보세요 (기존 계정 삭제 후)

